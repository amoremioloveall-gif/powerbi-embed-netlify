<!doctype html>
<html>
<head><meta charset="utf-8"><title>Power BI Embed (Netlify)</title></head>
<body>
  <h3>Power BI Report</h3>
  <div id="report" style="height:720px;border:1px solid #ddd"></div>

  <script src="https://cdn.jsdelivr.net/npm/powerbi-client/dist/powerbi.min.js"></script>
  <script>
    const models = window['powerbi-client'].models;
    async function load() {
      const r = await fetch('/.netlify/functions/embed-token');
      const j = await r.json();
      if (j.error) { console.error(j.error); return; }
      const config = {
        type: 'report',
        id: j.reportId,
        embedUrl: j.embedUrl,
        accessToken: j.token,
        tokenType: models.TokenType.Embed,
        settings: { panes: { filters: { visible: true } }, navContentPaneEnabled: true }
      };
      const report = powerbi.embed(document.getElementById('report'), config);
      report.on('loaded', () => console.log('loaded'));
      report.on('error', e => console.error(e.detail));
    }
    load();
  </script>
</body>
</html>
